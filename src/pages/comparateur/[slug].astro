---
// src/pages/comparateur/[slug].astro
// Pages comparateurs avec tableau responsive (mono-niche)
import SEOHead from '../../components/SEOHead.astro';
import Navigation from '../../components/Navigation.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import CookieConsent from '../../components/CookieConsent.astro';
import { comparateurs } from '../../data/comparateurs';
import { siteConfig } from '../../data/site-config';
import '../../styles/global.css';

export function getStaticPaths() {
  return comparateurs.map(c => ({
    params: { slug: c.slug },
    props: { comparateur: c },
  }));
}

const { comparateur } = Astro.props;
---

<!DOCTYPE html>
<html lang="fr">
<head>
  <SEOHead
    title={comparateur.metaTitle}
    description={comparateur.metaDescription}
  />
</head>
<body class="min-h-screen">
  <Navigation />

  <main class="max-w-6xl mx-auto px-4 py-8">
    <Breadcrumbs items={[
      { label: 'Accueil', href: '/' },
      { label: 'Comparateurs', href: '#' },
      { label: comparateur.title, href: `/comparateur/${comparateur.slug}` },
    ]} />

    <!-- Header -->
    <div class="bg-white rounded-2xl overflow-hidden mb-8" style="border: 1px solid rgba(0,0,0,0.06); box-shadow: 0 1px 3px rgba(0,0,0,0.04);">
      <div class="article-accent"></div>
      <div class="p-6 md:p-10">
        <span class="niche-badge mb-4">
          <Fragment set:html={siteConfig.nicheIcon} />
          <span class="ml-1.5">{siteConfig.nicheLabel}</span>
        </span>
        <h1 class="font-display mt-4 mb-3 leading-tight">{comparateur.title}</h1>
        <p class="text-lg text-warm-500 mb-4">{comparateur.description}</p>
        <div class="reading-meta">
          <span class="flex items-center gap-1.5">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
            Mis a jour le {new Date(comparateur.updatedDate).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' })}
          </span>
        </div>

        <p class="mt-6 text-warm-600">{comparateur.intro}</p>

        <!-- Tableau desktop -->
        <div class="hidden md:block mt-8 overflow-x-auto">
          <table class="w-full text-left border-collapse">
            <thead>
              <tr class="bg-niche-700">
                <th class="px-4 py-3 font-display text-sm font-semibold text-white rounded-tl-lg">Produit</th>
                <th class="px-4 py-3 font-display text-sm font-semibold text-white">Note</th>
                <th class="px-4 py-3 font-display text-sm font-semibold text-white">Prix</th>
                <th class="px-4 py-3 font-display text-sm font-semibold text-white">Avantages</th>
                <th class="px-4 py-3 font-display text-sm font-semibold text-white">Inconvenients</th>
                <th class="px-4 py-3 font-display text-sm font-semibold text-white rounded-tr-lg"></th>
              </tr>
            </thead>
            <tbody>
              {comparateur.products.map((product, i) => (
                <tr class={`${i % 2 === 0 ? 'bg-warm-50' : 'bg-white'} border-b`} style="border-color: rgba(0,0,0,0.06);">
                  <td class="px-4 py-4">
                    <div class="flex items-center gap-2">
                      <span class="font-display font-bold text-warm-900">{product.name}</span>
                      {product.choixRedaction && (
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-bold bg-niche-100 text-niche-700">
                          Choix de la redaction
                        </span>
                      )}
                    </div>
                  </td>
                  <td class="px-4 py-4">
                    <span class="font-display font-bold text-warm-900">{product.note}</span>
                    <span class="text-warm-400 text-sm">/10</span>
                  </td>
                  <td class="px-4 py-4 text-sm text-warm-600">{product.prix}</td>
                  <td class="px-4 py-4">
                    <ul class="text-sm text-warm-600 space-y-1 list-none pl-0">
                      {product.avantages.map(a => (
                        <li class="flex items-start gap-1.5">
                          <svg class="w-4 h-4 text-green-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                          {a}
                        </li>
                      ))}
                    </ul>
                  </td>
                  <td class="px-4 py-4">
                    <ul class="text-sm text-warm-600 space-y-1 list-none pl-0">
                      {product.inconvenients.map(inc => (
                        <li class="flex items-start gap-1.5">
                          <svg class="w-4 h-4 text-red-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                          {inc}
                        </li>
                      ))}
                    </ul>
                  </td>
                  <td class="px-4 py-4">
                    <a href={product.lienAffilie} target="_blank" rel="sponsored noopener" class="inline-flex items-center px-4 py-2 rounded-lg text-sm font-semibold text-white no-underline bg-niche-600 hover:bg-niche-700 transition-colors">
                      Voir l'offre
                    </a>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        <!-- Cartes mobile -->
        <div class="md:hidden mt-8 space-y-4">
          {comparateur.products.map(product => (
            <div class="bg-warm-50 rounded-xl p-5" style="border: 1px solid rgba(0,0,0,0.06);">
              <div class="flex items-center justify-between mb-3">
                <div>
                  <span class="font-display font-bold text-warm-900 text-lg">{product.name}</span>
                  {product.choixRedaction && (
                    <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-bold bg-niche-100 text-niche-700">
                      Choix redac
                    </span>
                  )}
                </div>
                <div class="text-right">
                  <span class="font-display font-bold text-warm-900 text-xl">{product.note}</span>
                  <span class="text-warm-400 text-sm">/10</span>
                </div>
              </div>
              <p class="text-sm text-warm-500 mb-3">{product.prix}</p>
              <div class="grid grid-cols-2 gap-3 mb-4">
                <div>
                  <p class="text-xs font-bold uppercase tracking-wider text-green-600 mb-1">Avantages</p>
                  <ul class="text-xs text-warm-600 space-y-1 list-none pl-0">
                    {product.avantages.slice(0, 3).map(a => (
                      <li class="flex items-start gap-1">
                        <svg class="w-3 h-3 text-green-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                        {a}
                      </li>
                    ))}
                  </ul>
                </div>
                <div>
                  <p class="text-xs font-bold uppercase tracking-wider text-red-500 mb-1">Limites</p>
                  <ul class="text-xs text-warm-600 space-y-1 list-none pl-0">
                    {product.inconvenients.map(inc => (
                      <li class="flex items-start gap-1">
                        <svg class="w-3 h-3 text-red-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                        {inc}
                      </li>
                    ))}
                  </ul>
                </div>
              </div>
              <a href={product.lienAffilie} target="_blank" rel="sponsored noopener" class="block text-center px-4 py-2.5 rounded-lg text-sm font-semibold text-white no-underline bg-niche-600 hover:bg-niche-700 transition-colors">
                Voir l'offre
              </a>
            </div>
          ))}
        </div>

        <!-- Disclaimer -->
        <p class="mt-8 text-xs text-warm-400 italic">
          * Les liens vers les produits sont des liens affilies. Nous pouvons percevoir une commission sans cout supplementaire pour vous.
          Les notes et avis sont bases sur nos tests independants.
        </p>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="site-footer-inner">
      <div class="site-footer-bottom">
        <p>&copy; {new Date().getFullYear()} {siteConfig.name}. Tous droits reserves.</p>
        <div class="flex justify-center gap-4 mt-2">
          <a href="/mentions-legales" class="site-footer-link">Mentions legales</a>
          <a href="/contact" class="site-footer-link">Contact</a>
          <a href="/a-propos" class="site-footer-link">A propos</a>
        </div>
      </div>
    </div>
  </footer>

  <CookieConsent />
</body>
</html>
